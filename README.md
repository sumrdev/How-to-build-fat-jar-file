# How to build a standalone jar file
by dafe, mawn and mvje

We assume that you have created or downloaded a gradle project.

Otherwise here :)
https://heathered-salmon-2d7.notion.site/Step-by-step-guide-434fee5564fd4a86ae114ffa0936abef

Disregard everything after this:  
*"If you try to run it using the “play” button in the vscode, you will encounter a run time error problem. To fix this issue, use the following steps."*
 
This guide will make a "fat" jar file that can run anywhere.

## Relevant documentation
If you don't want to follow a guide made on the fly here is the proper documentation used for this guide.

https://openjfx.io/openjfx-docs/#gradle 

## Why?

Some had issues running the jar file and submitting it, we found a way to build a fat jar file that works a bit smoother.

## Modifying build.gradle
Here you will need to add a few things
```gradle
plugins {
    // Apply the application plugin to add support for building a CLI application in Java.
    id 'application'

    //you need to add this line if it is not there
    id 'org.openjfx.javafxplugin' version '0.0.13'
}
```
Next add the javafx
```gradle
javafx {
    version = "19"
    modules = ['javafx.controls', 'javafx.fxml']
}
```

## Adding a "SuperMain" class
    
This is necessary since your main class is called App and extends Application. This means your build.gradle is confused and unhappy 

SuperMain class should be in your main/java/addressparsing folder, next to all your other java files.

Should contain
```java
package addressparsing;

public class SuperMain {
    public static void main(String[] args) {
        App.main(args);
    }
}

```
Then you also need to add some lines to your build.gradle file to configure this as your main class.

## Modifying build.gradle
Here you will need to add a few things
```gradle

plugins {
   // Apply the application plugin to add support for building a CLI application in Java.
   id 'application'


   //you need to add this line if it is not there
   id 'org.openjfx.javafxplugin' version '0.0.13'
}
```

Next add the javafx, this is just the dependecies inside javafx that you use. It is highly likely that you will use these.
```gradle
    javafx {
       version = "19"
       modules = ['javafx.controls', 'javafx.fxml']
    }
}
```


Next you need to make sure that you have given the right main class. This should look something like this.

```gradle
application {
   // Define the main class for the application.
   mainClass = 'addressparsing.App'
}
```

keep in mind that the main class is specific to your project.

when the main class has been specified you can add the following lines of code to your project


```gradle

//again add the path to the main class.
mainClassName = 'addressparsing.App'


jar {
 duplicatesStrategy = DuplicatesStrategy.EXCLUDE
 manifest {
   attributes(
       /*You will need to add a SuperMain class this will be explained latter*/
       'Main-Class': 'addressparsing.SuperMain'
   )
 }
 from {
   configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
 }
}
```

You will again have to change the mainClass to your specific project. But inside attributes the mainClass is not the same. This is on purpose, because you can’t have a class that extends application be your main class.

## Build your fat jar
Open your preferred terminal and navigate to root directory in your project.

Then run this command 

```bash
./gradlew jar
```
This acts like a build command but it will also include javafx in your jar file.

Then navigate to your /build/libs/

```bash
java -jar app.jar
```
If this file runs you can now zip your app.jar and run it anywhere, the file is now fat.

Otherwise check that you have a SuperMain class and possible mistakes in the build.gradle file.

Below is my working build.gradle file

## Resources folder
**If you access other files than your java files, then you need to put them in the /resource directory** otherwise the jar wont know where to find themm when you build the fat jar file
If you access resources in your project, and this does not work, try reading files with if you are using java 19.
```java
InputStream is = getClass().getResourceAsStream("/filename.txt");
Scanner s = new Scanner(new BufferedReader(new InputStreamReader(is)));
```
If this does not work, maybe you are in another version, try this. DO NOT specify the whole file path, if you have your resource folder put the correct place this will work. Resource folder should be in main/
```java
InputStream in = your_mainclass.class.getResourceAsStream("/filename.txt");
BufferedReader br = new BufferedReader(new InputStreamReader(in));
```

## Dumped build file
Remember to change main classes to correct names as specified above.

```gradle
/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java application project to get you started.
 * For more details take a look at the 'Building Java & JVM projects' chapter in the Gradle
 * User Manual available at https://docs.gradle.org/7.3/userguide/building_java_projects.html
 */

plugins {
    // Apply the application plugin to add support for building a CLI application in Java.
    id 'application'
    id 'org.openjfx.javafxplugin' version '0.0.13'
}

javafx {
    version = "19"
    modules = ['javafx.controls', 'javafx.fxml']
}

repositories {
    // Use Maven Central for resolving dependencies.
    mavenCentral()
}

dependencies {
    // Use JUnit Jupiter for testing.
    testImplementation 'org.junit.jupiter:junit-jupiter:5.7.2'

    // This dependency is used by the application.
    implementation 'com.google.guava:guava:30.1.1-jre'
}

application {
    // Define the main class for the application.
    mainClass = 'addressparsing.App'
}

tasks.named('test') {
    // Use JUnit Platform for unit tests.
    useJUnitPlatform()
}

mainClassName = 'addressparsing.App'

jar {
  duplicatesStrategy = DuplicatesStrategy.EXCLUDE
  manifest {
    attributes(
        'Main-Class': 'addressparsing.SuperMain'
    )
  }
  from {
    configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
  }
}
```
